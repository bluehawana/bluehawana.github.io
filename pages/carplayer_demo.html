<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
   <meta charset="utf-8">
   <title>CarPlayer IPTV Demo - Android Auto TV Player</title>
   <meta name="description" content="CarPlayer IPTV - Android Auto compatible IPTV player with smart network optimization and live streaming capabilities">
   <meta name="author" content="Hongzhi (Harvad) Li">
   <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
   
   <!-- CSS -->
   <link rel="stylesheet" href="../css/default.css">
   <link rel="stylesheet" href="../css/layout.css">
   <link rel="stylesheet" href="../css/media-queries.css">
   <link rel="shortcut icon" href="../favicon.png">
   
   <!-- VLC Web Plugin for IPTV stream compatibility -->
   <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
   <script src="https://unpkg.com/@videojs/http-streaming@3.0.2/dist/videojs-http-streaming.min.js"></script>
   <script src="https://vjs.zencdn.net/8.5.2/video.min.js"></script>
   <link href="https://vjs.zencdn.net/8.5.2/video-js.css" rel="stylesheet">
   
   <!-- VLC-like IPTV player styles -->
   <style>
   .video-js {
     font-family: 'Courier New', monospace !important;
   }
   .video-js .vjs-control-bar {
     background: rgba(17, 17, 17, 0.9) !important;
     border-top: 2px solid var(--cyber-primary);
   }
   .video-js .vjs-play-progress {
     background: var(--cyber-primary) !important;
   }
   .video-js .vjs-volume-level {
     background: var(--cyber-accent) !important;
   }
   </style>
   
   <!-- CarPlayer Demo Styles -->
   <style>
      :root {
         --cyber-bg: #0a0a0a;
         --cyber-dark: #111111;
         --cyber-primary: #00d4ff;
         --cyber-secondary: #bd93f9;
         --cyber-accent: #50fa7b;
         --cyber-warning: #ffff00;
         --cyber-danger: #ff073a;
         --cyber-text: #ffffff;
         --cyber-text-dim: #cccccc;
         --cyber-border: #333333;
         --neon-glow: 0 0 10px currentColor, 0 0 20px currentColor, 0 0 30px currentColor;
      }

      body {
         background: linear-gradient(135deg, var(--cyber-bg) 0%, var(--cyber-dark) 100%);
         color: var(--cyber-text);
         font-family: 'Courier New', 'Monaco', monospace;
         margin: 0;
         padding: 0;
      }

      .car-dashboard {
         background: linear-gradient(45deg, #0a0a0a 0%, #1a0033 50%, #000d1a 100%);
         min-height: 100vh;
         position: relative;
         overflow: hidden;
      }

      .dashboard-header {
         padding: 20px;
         border-bottom: 2px solid var(--cyber-primary);
         text-align: center;
         position: relative;
         z-index: 10;
      }

      .car-title {
         font-size: 36px;
         color: var(--cyber-primary);
         text-shadow: var(--neon-glow);
         margin-bottom: 10px;
      }

      .car-subtitle {
         color: var(--cyber-secondary);
         font-size: 16px;
         margin-bottom: 20px;
      }

      .main-screen {
         display: flex;
         height: calc(100vh - 120px);
      }

      .channel-list {
         width: 300px;
         background: rgba(17, 17, 17, 0.9);
         border-right: 2px solid var(--cyber-border);
         overflow-y: auto;
         padding: 20px;
      }

      .channel-item {
         display: flex;
         align-items: center;
         padding: 15px;
         margin-bottom: 10px;
         background: linear-gradient(145deg, #111111 0%, #1a1a1a 50%, #0f0f0f 100%);
         border: 1px solid var(--cyber-border);
         border-radius: 8px;
         cursor: pointer;
         transition: all 0.3s ease;
      }

      .channel-item:hover, .channel-item.active {
         border-color: var(--cyber-primary);
         box-shadow: 0 4px 15px rgba(0, 212, 255, 0.15);
         transform: translateY(-2px);
      }

      .channel-logo {
         width: 40px;
         height: 40px;
         background: var(--cyber-primary);
         border-radius: 6px;
         display: flex;
         align-items: center;
         justify-content: center;
         margin-right: 15px;
         font-weight: bold;
         color: black;
      }

      .channel-info h4 {
         color: var(--cyber-accent);
         margin: 0 0 5px 0;
         font-size: 14px;
      }

      .channel-info p {
         color: var(--cyber-text-dim);
         margin: 0;
         font-size: 12px;
      }

      .player-area {
         flex: 1;
         display: flex;
         flex-direction: column;
         position: relative;
      }

      .video-container {
         flex: 1;
         background: #000;
         position: relative;
         display: flex;
         align-items: center;
         justify-content: center;
         border: 2px solid var(--cyber-primary);
         margin: 20px;
         border-radius: 10px;
         overflow: hidden;
      }

      .video-placeholder {
         color: var(--cyber-text-dim);
         font-size: 24px;
         text-align: center;
      }

      .player-controls {
         padding: 20px;
         background: rgba(17, 17, 17, 0.9);
         border-top: 2px solid var(--cyber-border);
         display: flex;
         justify-content: center;
         align-items: center;
         gap: 20px;
      }

      .control-btn {
         background: transparent;
         border: 2px solid var(--cyber-primary);
         color: var(--cyber-primary);
         padding: 15px;
         border-radius: 50%;
         width: 60px;
         height: 60px;
         cursor: pointer;
         transition: all 0.3s ease;
         display: flex;
         align-items: center;
         justify-content: center;
         font-size: 20px;
         position: relative;
         overflow: hidden;
      }

      .control-btn::before {
         content: '';
         position: absolute;
         top: 0;
         left: -100%;
         width: 100%;
         height: 100%;
         background: var(--cyber-primary);
         transition: left 0.3s ease;
         z-index: -1;
      }

      .control-btn:hover::before {
         left: 0;
      }

      .control-btn:hover {
         color: var(--cyber-bg);
         box-shadow: 0 0 15px rgba(0, 212, 255, 0.6);
      }

      .volume-control {
         display: flex;
         align-items: center;
         gap: 10px;
      }

      .volume-slider {
         width: 100px;
         height: 4px;
         background: var(--cyber-border);
         border-radius: 2px;
         outline: none;
         -webkit-appearance: none;
      }

      .volume-slider::-webkit-slider-thumb {
         appearance: none;
         width: 16px;
         height: 16px;
         background: var(--cyber-primary);
         border-radius: 50%;
         cursor: pointer;
         box-shadow: 0 0 10px rgba(0, 212, 255, 0.5);
      }

      .status-bar {
         position: absolute;
         top: 20px;
         right: 20px;
         background: rgba(17, 17, 17, 0.9);
         padding: 10px 15px;
         border-radius: 8px;
         border: 1px solid var(--cyber-border);
         font-size: 12px;
         z-index: 20;
      }

      .network-status {
         color: var(--cyber-accent);
         margin-bottom: 5px;
      }

      .quality-status {
         color: var(--cyber-warning);
      }

      .firebase-section {
         background: linear-gradient(145deg, #111111 0%, #1a1a1a 100%);
         border: 2px solid var(--cyber-secondary);
         border-radius: 10px;
         padding: 30px;
         margin: 40px 20px;
         position: relative;
         overflow: hidden;
      }

      .firebase-section::before {
         content: '';
         position: absolute;
         top: 0;
         left: -100%;
         width: 100%;
         height: 100%;
         background: linear-gradient(90deg, transparent, rgba(189, 147, 249, 0.1), transparent);
         transition: left 0.8s ease;
      }

      .firebase-section:hover::before {
         left: 100%;
      }

      .firebase-title {
         color: var(--cyber-secondary);
         font-size: 24px;
         text-align: center;
         margin-bottom: 20px;
         text-shadow: var(--neon-glow);
      }

      .download-btn {
         background: transparent;
         border: 2px solid var(--cyber-secondary);
         color: var(--cyber-secondary);
         padding: 15px 30px;
         font-family: inherit;
         font-size: 16px;
         text-transform: uppercase;
         letter-spacing: 1px;
         cursor: pointer;
         transition: all 0.3s ease;
         text-decoration: none;
         display: inline-block;
         margin: 10px;
         position: relative;
         overflow: hidden;
      }

      .download-btn::before {
         content: '';
         position: absolute;
         top: 0;
         left: -100%;
         width: 100%;
         height: 100%;
         background: var(--cyber-secondary);
         transition: left 0.3s ease;
         z-index: -1;
      }

      .download-btn:hover::before {
         left: 0;
      }

      .download-btn:hover {
         color: var(--cyber-bg);
         box-shadow: 0 0 15px rgba(189, 147, 249, 0.6);
      }

      .features-grid {
         display: grid;
         grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
         gap: 20px;
         margin-top: 30px;
      }

      .feature-card {
         background: rgba(17, 17, 17, 0.7);
         border: 1px solid var(--cyber-border);
         border-radius: 8px;
         padding: 20px;
         text-align: center;
      }

      .feature-icon {
         font-size: 36px;
         color: var(--cyber-primary);
         margin-bottom: 15px;
      }

      .feature-title {
         color: var(--cyber-accent);
         font-size: 16px;
         margin-bottom: 10px;
      }

      .feature-desc {
         color: var(--cyber-text-dim);
         font-size: 14px;
         line-height: 1.4;
      }

      @media screen and (max-width: 768px) {
         .main-screen {
            flex-direction: column;
         }
         
         .channel-list {
            width: 100%;
            height: 200px;
         }
         
         .car-title {
            font-size: 24px;
         }
         
         .player-controls {
            flex-wrap: wrap;
         }
      }
   </style>
</head>

<body>
   <div class="car-dashboard">
      <div class="status-bar">
         <div class="network-status" id="network-status">📶 WiFi Connected</div>
         <div class="quality-status" id="quality-status">🎯 HD Quality</div>
      </div>

      <div class="dashboard-header">
         <h1 class="car-title">🚗 CARPLAYER_IPTV.APK</h1>
         <p class="car-subtitle">> Android Auto IPTV Player with Smart Network Optimization</p>
      </div>

      <div class="main-screen">
         <div class="channel-list">
            <div class="channel-item active" data-channel="aje">
               <div class="channel-logo">AJE</div>
               <div class="channel-info">
                  <h4>Al Jazeera English</h4>
                  <p>News • HD • Working ✅</p>
               </div>
            </div>
            <div class="channel-item" data-channel="bbc">
               <div class="channel-logo">BBC</div>
               <div class="channel-info">
                  <h4>BBC World News</h4>
                  <p>News • HD • Testing</p>
               </div>
            </div>
            <div class="channel-item" data-channel="cnn">
               <div class="channel-logo">CNN</div>
               <div class="channel-info">
                  <h4>CNN International</h4>
                  <p>News • HD • Testing</p>
               </div>
            </div>
            <div class="channel-item" data-channel="sky">
               <div class="channel-logo">SKY</div>
               <div class="channel-info">
                  <h4>Sky News</h4>
                  <p>News • HD • Testing</p>
               </div>
            </div>
            <div class="channel-item" data-channel="cnbc">
               <div class="channel-logo">CNBC</div>
               <div class="channel-info">
                  <h4>CNBC Business</h4>
                  <p>Business • HD • Testing</p>
               </div>
            </div>
            <div class="channel-item" data-channel="demo">
               <div class="channel-logo">📱</div>
               <div class="channel-info">
                  <h4>CarPlayer Demo</h4>
                  <p>Demo Video • HD</p>
               </div>
            </div>
         </div>

         <div class="player-area">
            <div class="video-container">
               <video-js id="video-player" class="video-js vjs-default-skin" 
                         controls preload="auto" width="100%" height="100%" 
                         data-setup='{"fluid": true, "responsive": true}'>
                  <source src="https://pub-bdb0b5850f04423d901ad6e7e1195a2a.r2.dev/cartvfirebase/10.mp4" type="video/mp4" label="Demo Video">
                  <p class="vjs-no-js">
                     To view this video please enable JavaScript, and consider upgrading to a web browser that
                     <a href="https://videojs.com/html5-video-support/" target="_blank">supports HTML5 video</a>.
                  </p>
               </video-js>
               <div class="video-placeholder" id="video-placeholder" style="display: none;">
                  <div>📺 Select a channel from the left</div>
                  <div style="font-size: 16px; margin-top: 20px; color: var(--cyber-text-dim);">
                     IPTV streaming with VLC engine support
                  </div>
               </div>
            </div>
         </div>
      </div>

      <div class="player-controls">
         <button class="control-btn" id="prev-btn" title="Previous Channel">⏮</button>
         <button class="control-btn" id="play-pause-btn" title="Play/Pause">▶</button>
         <button class="control-btn" id="next-btn" title="Next Channel">⏭</button>
         
         <div class="volume-control">
            <span style="color: var(--cyber-primary);">🔊</span>
            <input type="range" class="volume-slider" id="volume-slider" min="0" max="100" value="50">
            <span style="color: var(--cyber-text-dim); font-size: 12px;" id="volume-display">50%</span>
         </div>
         
         <button class="control-btn" id="fullscreen-btn" title="Fullscreen">⛶</button>
      </div>

      <div class="firebase-section">
         <h2 class="firebase-title">📱 DOWNLOAD APK & TEST ON ANDROID AUTO</h2>
         
         <div style="text-align: center; margin-bottom: 30px;">
            <p style="color: var(--cyber-text-dim); font-size: 16px; line-height: 1.6;">
               Experience the full CarPlayer IPTV app on your Android Auto system.<br>
               Download the APK and test all features in your car.
            </p>
         </div>

         <div style="text-align: center;">
            <a href="#" class="download-btn" onclick="downloadAPK('carplayer')">
               📱 DOWNLOAD CARPLAYER APK
            </a>
            <a href="https://github.com/bluehawana/carplayer-kotlin-androidauto" target="_blank" class="download-btn">
               📂 VIEW SOURCE CODE
            </a>
         </div>

         <div class="features-grid">
            <div class="feature-card">
               <div class="feature-icon">🎯</div>
               <div class="feature-title">Smart Network Optimization</div>
               <div class="feature-desc">Automatically detects cellular hotspot and optimizes streaming quality</div>
            </div>
            <div class="feature-card">
               <div class="feature-icon">🚗</div>
               <div class="feature-title">Android Auto Native</div>
               <div class="feature-desc">Designed specifically for car infotainment systems with safe controls</div>
            </div>
            <div class="feature-card">
               <div class="feature-icon">📡</div>
               <div class="feature-title">IPTV & M3U Support</div>
               <div class="feature-desc">Import M3U playlists and manage IPTV subscriptions easily</div>
            </div>
            <div class="feature-card">
               <div class="feature-icon">🔄</div>
               <div class="feature-title">Hybrid Media Engine</div>
               <div class="feature-desc">ExoPlayer + VLC fallback with intelligent switching for best compatibility</div>
            </div>
         </div>
      </div>
   </div>

   <script>
      // Updated IPTV channels - Testing new sources (Al Jazeera confirmed working)
      const demoStreams = {
         'aje': 'http://mwyceyp.mhubery.xyz:80/live/2161039006/6680421603/400230347.m3u8',
         'aje_backup': 'http://live-hls-web-aje.getaj.net/AJE/01.m3u8',
         'bbc': 'http://mwyceyp.mhubery.xyz:80/live/2161039006/6680421603/40091.m3u8',
         'cnn': 'http://mwyceyp.mhubery.xyz:80/live/2161039006/6680421603/36480.m3u8',
         'sky': 'http://mwyceyp.mhubery.xyz:80/live/2161039006/6680421603/153846.m3u8',
         'cnbc': 'http://mwyceyp.mhubery.xyz:80/live/2161039006/6680421603/82803.m3u8',
         'france24': 'http://mwyceyp.mhubery.xyz:80/live/2161039006/6680421603/153855.m3u8',
         'rt': 'http://mwyceyp.mhubery.xyz:80/live/2161039006/6680421603/181651.m3u8',
         'dw': 'http://mwyceyp.mhubery.xyz:80/live/2161039006/6680421603/176619.m3u8',
         'demo': 'https://pub-bdb0b5850f04423d901ad6e7e1195a2a.r2.dev/cartvfirebase/10.mp4'
      };

      let currentChannel = 'aje';
      let isPlaying = false;
      let currentChannelIndex = 0;
      let player;
      const channels = ['aje', 'bbc', 'cnn', 'sky', 'cnbc', 'demo'];

      // Network simulation
      function simulateNetworkDetection() {
         const networks = [
            { status: '📶 WiFi Connected', quality: '🎯 HD Quality' },
            { status: '📱 Hotspot Detected', quality: '🚀 5G Optimized' },
            { status: '📡 Cellular Network', quality: '🔄 Adaptive Quality' },
            { status: '🐌 Low Bandwidth', quality: '💾 Data Saver Mode' }
         ];
         
         let networkIndex = 0;
         setInterval(() => {
            const network = networks[networkIndex];
            document.getElementById('network-status').textContent = network.status;
            document.getElementById('quality-status').textContent = network.quality;
            networkIndex = (networkIndex + 1) % networks.length;
         }, 5000);
      }

      // Initialize VLC-like player with enhanced IPTV support
      function initializePlayer() {
         player = videojs('video-player', {
            fluid: true,
            responsive: true,
            liveui: true,
            controls: true,
            preload: 'none',
            techOrder: ['html5'],
            html5: {
               hls: {
                  enableLowInitialPlaylist: true,
                  smoothQualityChange: true,
                  overrideNative: true,
                  withCredentials: false,
                  handleManifestRedirects: true
               },
               vhs: {
                  overrideNative: true,
                  enableLowInitialPlaylist: true,
                  smoothQualityChange: true,
                  handlePartialData: true,
                  experimentalBufferBasedABR: true
               }
            },
            playbackRates: [0.5, 1, 1.25, 1.5, 2],
            sources: []
         });

         // VLC-like error recovery
         player.on('error', function() {
            const error = player.error();
            console.log('Player error:', error);
            
            if (error && error.code === 4) {
               // Network error - try to reload
               setTimeout(() => {
                  player.load();
               }, 3000);
            }
         });

         player.ready(() => {
            console.log('VLC-like IPTV player ready');
            loadChannel('aje'); // Start with Al Jazeera English
         });
      }

      // Load and play channel with VLC-like handling
      function loadChannel(channelId) {
         const streamUrl = demoStreams[channelId];
         const channelName = document.querySelector(`[data-channel="${channelId}"] h4`).textContent;
         
         if (!streamUrl) return;
         
         try {
            // Show loading state
            updateStreamStatus(`📺 Loading ${channelName}...`, '🔄 VLC Engine Connecting...');
            
            // Stop current playback
            if (player && player.readyState() > 0) {
               player.pause();
               player.currentTime(0);
            }
            
            if (channelId === 'demo') {
               // For demo video (MP4)
               player.src({
                  type: 'video/mp4',
                  src: streamUrl
               });
            } else {
               // For IPTV/HLS streams - VLC-like approach
               const sources = [
                  {
                     type: 'application/x-mpegURL',
                     src: streamUrl
                  }
               ];
               
               // Add backup source for Al Jazeera
               if (channelId === 'aje' && demoStreams.aje_backup) {
                  sources.push({
                     type: 'application/x-mpegURL',
                     src: demoStreams.aje_backup
                  });
               }
               
               player.src(sources);
            }
            
            // VLC-like loading events
            player.one('loadstart', () => {
               updateStreamStatus(`📺 ${channelName}`, '⏳ VLC Loading Stream...');
            });
            
            player.one('canplay', () => {
               updateStreamStatus(`📺 ${channelName}`, '✅ VLC Stream Ready • HD');
               player.play().then(() => {
                  isPlaying = true;
                  updateStreamStatus(`📺 ${channelName}`, '▶️ Playing Live • VLC Engine');
               }).catch(e => {
                  console.log('Autoplay prevented:', e);
                  updateStreamStatus(`📺 ${channelName}`, '⏸️ Ready to Play • Click Play');
               });
            });
            
            player.one('error', (e) => {
               console.error('VLC Player Error:', e);
               updateStreamStatus(`❌ ${channelName}`, '⚠️ VLC Stream Error');
               
               // Try backup for Al Jazeera
               if (channelId === 'aje' && demoStreams.aje_backup) {
                  setTimeout(() => {
                     updateStreamStatus(`📺 ${channelName}`, '🔄 VLC Trying Backup...');
                     player.src({
                        type: 'application/x-mpegURL',
                        src: demoStreams.aje_backup
                     });
                  }, 2000);
               }
            });
            
         } catch (error) {
            console.error('VLC Channel load error:', error);
            updateStreamStatus(`❌ ${channelName}`, '⚠️ VLC Engine Error');
         }
      }

      // Update stream status display
      function updateStreamStatus(title, status) {
         const placeholder = document.getElementById('video-placeholder');
         if (placeholder) {
            placeholder.innerHTML = `
               <div>${title}</div>
               <div style="font-size: 16px; margin-top: 20px; color: var(--cyber-accent);">
                  ${status}
               </div>
            `;
         }
      }

      // Channel selection with actual streaming
      document.querySelectorAll('.channel-item').forEach(item => {
         item.addEventListener('click', function() {
            document.querySelectorAll('.channel-item').forEach(i => i.classList.remove('active'));
            this.classList.add('active');
            
            const channelId = this.dataset.channel;
            currentChannel = channelId;
            currentChannelIndex = channels.indexOf(channelId);
            
            // Load the actual stream
            loadChannel(channelId);
         });
      });

      // Player controls
      document.getElementById('play-pause-btn').addEventListener('click', function() {
         isPlaying = !isPlaying;
         this.textContent = isPlaying ? '⏸' : '▶';
         
         const placeholder = document.getElementById('video-placeholder');
         if (isPlaying) {
            placeholder.innerHTML = placeholder.innerHTML.replace('⏸ Stream Paused', '▶ Stream Active');
         } else {
            placeholder.innerHTML = placeholder.innerHTML.replace('▶ Stream Active', '⏸ Stream Paused');
         }
      });

      document.getElementById('prev-btn').addEventListener('click', function() {
         currentChannelIndex = currentChannelIndex > 0 ? currentChannelIndex - 1 : channels.length - 1;
         document.querySelectorAll('.channel-item')[currentChannelIndex].click();
      });

      document.getElementById('next-btn').addEventListener('click', function() {
         currentChannelIndex = (currentChannelIndex + 1) % channels.length;
         document.querySelectorAll('.channel-item')[currentChannelIndex].click();
      });

      // Volume control
      const volumeSlider = document.getElementById('volume-slider');
      const volumeDisplay = document.getElementById('volume-display');
      
      volumeSlider.addEventListener('input', function() {
         volumeDisplay.textContent = this.value + '%';
      });

      // Fullscreen simulation
      document.getElementById('fullscreen-btn').addEventListener('click', function() {
         alert('🚗 Android Auto Fullscreen Mode\n\nThis would enable fullscreen mode on your car display.');
      });

      // APK download via Firebase App Distribution
      function downloadAPK(appName) {
         if (appName === 'carplayer') {
            window.open('https://appdistribution.firebase.google.com/testerapps/1:1055425659261:android:5ee98a20ffff8d755c8c14/releases/4akk35cdhi1lo', '_blank');
         }
      }

      // Initialize demo
      simulateNetworkDetection();
      
      // Initialize Video.js player when page loads
      document.addEventListener('DOMContentLoaded', function() {
         initializePlayer();
      });
      
      // Auto-select first channel (Al Jazeera English) after player loads
      setTimeout(() => {
         document.querySelector('.channel-item').click();
      }, 2000);
   </script>
</body>
</html>