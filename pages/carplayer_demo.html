<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
   <meta charset="utf-8">
   <title>CarPlayer IPTV Demo - Android Auto TV Player</title>
   <meta name="description" content="CarPlayer IPTV - Android Auto compatible IPTV player with smart network optimization and live streaming capabilities">
   <meta name="author" content="Hongzhi (Harvad) Li">
   <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
   
   <!-- CSS -->
   <link rel="stylesheet" href="../css/default.css">
   <link rel="stylesheet" href="../css/layout.css">
   <link rel="stylesheet" href="../css/media-queries.css">
   <link rel="shortcut icon" href="../favicon.png">
   
   <!-- HLS.js for better browser compatibility -->
   <script src="https://cdn.jsdelivr.net/npm/hls.js@1.4.12/dist/hls.min.js"></script>
   
   <!-- CarPlayer Demo Styles -->
   <style>
      :root {
         --cyber-bg: #0a0a0a;
         --cyber-dark: #111111;
         --cyber-primary: #00d4ff;
         --cyber-secondary: #bd93f9;
         --cyber-accent: #50fa7b;
         --cyber-warning: #ffff00;
         --cyber-danger: #ff073a;
         --cyber-text: #ffffff;
         --cyber-text-dim: #cccccc;
         --cyber-border: #333333;
         --neon-glow: 0 0 10px currentColor, 0 0 20px currentColor, 0 0 30px currentColor;
      }

      body {
         background: linear-gradient(135deg, var(--cyber-bg) 0%, var(--cyber-dark) 100%);
         color: var(--cyber-text);
         font-family: 'Courier New', 'Monaco', monospace;
         margin: 0;
         padding: 0;
      }

      .car-dashboard {
         background: linear-gradient(45deg, #0a0a0a 0%, #1a0033 50%, #000d1a 100%);
         min-height: 100vh;
         position: relative;
         overflow: hidden;
      }

      .dashboard-header {
         padding: 20px;
         border-bottom: 2px solid var(--cyber-primary);
         text-align: center;
         position: relative;
         z-index: 10;
      }

      .car-title {
         font-size: 36px;
         color: var(--cyber-primary);
         text-shadow: var(--neon-glow);
         margin-bottom: 10px;
      }

      .car-subtitle {
         color: var(--cyber-secondary);
         font-size: 16px;
         margin-bottom: 20px;
      }

      .main-screen {
         display: flex;
         height: calc(100vh - 120px);
      }

      .channel-list {
         width: 300px;
         background: rgba(17, 17, 17, 0.9);
         border-right: 2px solid var(--cyber-border);
         overflow-y: auto;
         padding: 20px;
         max-height: calc(100vh - 120px);
      }

      .channel-item {
         display: flex;
         align-items: center;
         padding: 15px;
         margin-bottom: 10px;
         background: linear-gradient(145deg, #111111 0%, #1a1a1a 50%, #0f0f0f 100%);
         border: 1px solid var(--cyber-border);
         border-radius: 8px;
         cursor: pointer;
         transition: all 0.3s ease;
      }

      .channel-item:hover, .channel-item.active {
         border-color: var(--cyber-primary);
         box-shadow: 0 4px 15px rgba(0, 212, 255, 0.15);
         transform: translateY(-2px);
      }

      .channel-logo {
         width: 40px;
         height: 40px;
         background: var(--cyber-primary);
         border-radius: 6px;
         display: flex;
         align-items: center;
         justify-content: center;
         margin-right: 15px;
         font-weight: bold;
         color: black;
      }

      .channel-info h4 {
         color: var(--cyber-accent);
         margin: 0 0 5px 0;
         font-size: 14px;
      }

      .channel-info p {
         color: var(--cyber-text-dim);
         margin: 0;
         font-size: 12px;
      }

      .player-area {
         flex: 1;
         display: flex;
         flex-direction: column;
         position: relative;
      }

      .video-container {
         flex: 1;
         background: #000;
         position: relative;
         display: flex;
         align-items: center;
         justify-content: center;
         border: 2px solid var(--cyber-primary);
         margin: 20px;
         border-radius: 10px;
         overflow: hidden;
      }

      .video-placeholder {
         color: var(--cyber-text-dim);
         font-size: 24px;
         text-align: center;
      }

      .player-controls {
         padding: 20px;
         background: rgba(17, 17, 17, 0.9);
         border-top: 2px solid var(--cyber-border);
         display: flex;
         justify-content: center;
         align-items: center;
         gap: 20px;
      }

      .control-btn {
         background: transparent;
         border: 2px solid var(--cyber-primary);
         color: var(--cyber-primary);
         padding: 15px;
         border-radius: 50%;
         width: 60px;
         height: 60px;
         cursor: pointer;
         transition: all 0.3s ease;
         display: flex;
         align-items: center;
         justify-content: center;
         font-size: 20px;
         position: relative;
         overflow: hidden;
      }

      .control-btn::before {
         content: '';
         position: absolute;
         top: 0;
         left: -100%;
         width: 100%;
         height: 100%;
         background: var(--cyber-primary);
         transition: left 0.3s ease;
         z-index: -1;
      }

      .control-btn:hover::before {
         left: 0;
      }

      .control-btn:hover {
         color: var(--cyber-bg);
         box-shadow: 0 0 15px rgba(0, 212, 255, 0.6);
      }

      .volume-control {
         display: flex;
         align-items: center;
         gap: 10px;
      }

      .volume-slider {
         width: 100px;
         height: 4px;
         background: var(--cyber-border);
         border-radius: 2px;
         outline: none;
         -webkit-appearance: none;
      }

      .volume-slider::-webkit-slider-thumb {
         appearance: none;
         width: 16px;
         height: 16px;
         background: var(--cyber-primary);
         border-radius: 50%;
         cursor: pointer;
         box-shadow: 0 0 10px rgba(0, 212, 255, 0.5);
      }

      .status-bar {
         position: absolute;
         top: 20px;
         right: 20px;
         background: rgba(17, 17, 17, 0.9);
         padding: 10px 15px;
         border-radius: 8px;
         border: 1px solid var(--cyber-border);
         font-size: 12px;
         z-index: 20;
      }

      .network-status {
         color: var(--cyber-accent);
         margin-bottom: 5px;
      }

      .quality-status {
         color: var(--cyber-warning);
      }

      .firebase-section {
         background: linear-gradient(145deg, #111111 0%, #1a1a1a 100%);
         border: 2px solid var(--cyber-secondary);
         border-radius: 10px;
         padding: 30px;
         margin: 40px 20px;
         position: relative;
         overflow: hidden;
      }

      .firebase-section::before {
         content: '';
         position: absolute;
         top: 0;
         left: -100%;
         width: 100%;
         height: 100%;
         background: linear-gradient(90deg, transparent, rgba(189, 147, 249, 0.1), transparent);
         transition: left 0.8s ease;
      }

      .firebase-section:hover::before {
         left: 100%;
      }

      .firebase-title {
         color: var(--cyber-secondary);
         font-size: 24px;
         text-align: center;
         margin-bottom: 20px;
         text-shadow: var(--neon-glow);
      }

      .download-btn {
         background: transparent;
         border: 2px solid var(--cyber-secondary);
         color: var(--cyber-secondary);
         padding: 15px 30px;
         font-family: inherit;
         font-size: 16px;
         text-transform: uppercase;
         letter-spacing: 1px;
         cursor: pointer;
         transition: all 0.3s ease;
         text-decoration: none;
         display: inline-block;
         margin: 10px;
         position: relative;
         overflow: hidden;
      }

      .download-btn::before {
         content: '';
         position: absolute;
         top: 0;
         left: -100%;
         width: 100%;
         height: 100%;
         background: var(--cyber-secondary);
         transition: left 0.3s ease;
         z-index: -1;
      }

      .download-btn:hover::before {
         left: 0;
      }

      .download-btn:hover {
         color: var(--cyber-bg);
         box-shadow: 0 0 15px rgba(189, 147, 249, 0.6);
      }

      .features-grid {
         display: grid;
         grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
         gap: 20px;
         margin-top: 30px;
      }

      .feature-card {
         background: rgba(17, 17, 17, 0.7);
         border: 1px solid var(--cyber-border);
         border-radius: 8px;
         padding: 20px;
         text-align: center;
      }

      .feature-icon {
         font-size: 36px;
         color: var(--cyber-primary);
         margin-bottom: 15px;
      }

      .feature-title {
         color: var(--cyber-accent);
         font-size: 16px;
         margin-bottom: 10px;
      }

      .feature-desc {
         color: var(--cyber-text-dim);
         font-size: 14px;
         line-height: 1.4;
      }

      /* Testing Gallery Styles */
      .testing-gallery {
         width: 100%;
      }

      .gallery-section {
         margin-bottom: 40px;
      }

      .screenshot-grid, .video-grid {
         display: grid;
         grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
         gap: 20px;
         margin-top: 20px;
      }

      .screenshot-item, .video-item {
         background: rgba(17, 17, 17, 0.7);
         border: 1px solid var(--cyber-border);
         border-radius: 8px;
         padding: 20px;
         text-align: center;
         cursor: pointer;
         transition: all 0.3s ease;
         position: relative;
         overflow: hidden;
      }

      .screenshot-item:hover, .video-item:hover {
         border-color: var(--cyber-primary);
         box-shadow: 0 4px 15px rgba(0, 212, 255, 0.15);
         transform: translateY(-2px);
      }

      .screenshot-placeholder, .video-placeholder {
         display: flex;
         flex-direction: column;
         align-items: center;
         gap: 10px;
      }

      .screenshot-icon, .video-icon {
         font-size: 48px;
         color: var(--cyber-primary);
         margin-bottom: 10px;
      }

      .screenshot-title, .video-title {
         color: var(--cyber-accent);
         font-size: 16px;
         font-weight: bold;
         margin-bottom: 5px;
      }

      .screenshot-desc, .video-desc {
         color: var(--cyber-text-dim);
         font-size: 14px;
         line-height: 1.4;
      }

      .video-duration {
         position: absolute;
         top: 10px;
         right: 10px;
         background: rgba(0, 0, 0, 0.8);
         color: var(--cyber-primary);
         padding: 4px 8px;
         border-radius: 4px;
         font-size: 12px;
      }

      @media screen and (max-width: 768px) {
         .main-screen {
            flex-direction: column;
         }
         
         .channel-list {
            width: 100%;
            height: 200px;
         }
         
         .car-title {
            font-size: 24px;
         }
         
         .player-controls {
            flex-wrap: wrap;
         }
         
         .screenshot-grid, .video-grid {
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
         }
      }
   </style>
</head>

<body>
   <div class="car-dashboard">
      <div class="status-bar">
         <div class="network-status" id="network-status">üì∂ WiFi Connected</div>
         <div class="quality-status" id="quality-status">üéØ HD Quality</div>
      </div>

      <div class="dashboard-header">
         <h1 class="car-title">üöó CARPLAYER_IPTV.APK</h1>
         <p class="car-subtitle">> Android Auto IPTV Player with Smart Network Optimization</p>
      </div>

      <div class="main-screen">
         <div class="channel-list">
            <div class="channel-item active" data-channel="demo1">
               <div class="channel-logo">CNN</div>
               <div class="channel-info">
                  <h4>CNN International</h4>
                  <p>World News ‚Ä¢ HD</p>
               </div>
            </div>
            <div class="channel-item" data-channel="demo2">
               <div class="channel-logo">SKY</div>
               <div class="channel-info">
                  <h4>Sky Sports News</h4>
                  <p>Sports News ‚Ä¢ HD</p>
               </div>
            </div>
            <div class="channel-item" data-channel="demo3">
               <div class="channel-logo">USA</div>
               <div class="channel-info">
                  <h4>USA Today</h4>
                  <p>USA News ‚Ä¢ HD</p>
               </div>
            </div>
            <div class="channel-item" data-channel="demo4">
               <div class="channel-logo">DW</div>
               <div class="channel-info">
                  <h4>DW English</h4>
                  <p>Germany News ‚Ä¢ HD</p>
               </div>
            </div>
            <div class="channel-item" data-channel="demo5">
               <div class="channel-logo">AJE</div>
               <div class="channel-info">
                  <h4>Al Jazeera</h4>
                  <p>Middle East News ‚Ä¢ HD</p>
               </div>
            </div>
            <div class="channel-item" data-channel="demo6">
               <div class="channel-logo">SS1</div>
               <div class="channel-info">
                  <h4>Sky Sports Main Event</h4>
                  <p>Sports ‚Ä¢ HD</p>
               </div>
            </div>
            <div class="channel-item" data-channel="demo7">
               <div class="channel-logo">SS2</div>
               <div class="channel-info">
                  <h4>Sky Sports Premier League</h4>
                  <p>Sports ‚Ä¢ HD</p>
               </div>
            </div>
            <div class="channel-item" data-channel="demo8">
               <div class="channel-logo">SS+</div>
               <div class="channel-info">
                  <h4>Sky Sports+</h4>
                  <p>Sports ‚Ä¢ HD</p>
               </div>
            </div>
            <div class="channel-item" data-channel="demo9">
               <div class="channel-logo">SSF</div>
               <div class="channel-info">
                  <h4>Sky Sports Football</h4>
                  <p>Sports ‚Ä¢ HD</p>
               </div>
            </div>
            <div class="channel-item" data-channel="demo10">
               <div class="channel-logo">SSC</div>
               <div class="channel-info">
                  <h4>Sky Sports Cricket</h4>
                  <p>Sports ‚Ä¢ HD</p>
               </div>
            </div>
            <div class="channel-item" data-channel="demo11">
               <div class="channel-logo">SST</div>
               <div class="channel-info">
                  <h4>Sky Sports Tennis</h4>
                  <p>Sports ‚Ä¢ HD</p>
               </div>
            </div>
            <div class="channel-item" data-channel="demo12">
               <div class="channel-logo">F1</div>
               <div class="channel-info">
                  <h4>Sky Sports F1</h4>
                  <p>Sports ‚Ä¢ HD</p>
               </div>
            </div>
         </div>

         <div class="player-area">
            <div class="video-container">
               <div class="video-placeholder" id="video-placeholder">
                  <div>üé¨ Select a channel to start streaming</div>
                  <div style="font-size: 16px; margin-top: 20px; color: var(--cyber-text-dim);">
                     Demo player ready - Android Auto optimized interface
                  </div>
               </div>
               <video id="video-player" style="width: 100%; height: 100%; display: none;" controls></video>
            </div>
         </div>
      </div>

      <div class="player-controls">
         <button class="control-btn" id="prev-btn" title="Previous Channel">‚èÆ</button>
         <button class="control-btn" id="play-pause-btn" title="Play/Pause">‚ñ∂</button>
         <button class="control-btn" id="next-btn" title="Next Channel">‚è≠</button>
         
         <div class="volume-control">
            <span style="color: var(--cyber-primary);">üîä</span>
            <input type="range" class="volume-slider" id="volume-slider" min="0" max="100" value="50">
            <span style="color: var(--cyber-text-dim); font-size: 12px;" id="volume-display">50%</span>
         </div>
         
         <button class="control-btn" id="fullscreen-btn" title="Fullscreen">‚õ∂</button>
      </div>

      <div class="firebase-section">
         <h2 class="firebase-title">üì± DOWNLOAD APK & TEST ON ANDROID AUTO</h2>
         
         <div style="text-align: center; margin-bottom: 30px;">
            <p style="color: var(--cyber-text-dim); font-size: 16px; line-height: 1.6;">
               Experience the full CarPlayer IPTV app on your Android Auto system.<br>
               Download the APK and test all features in your car.
            </p>
         </div>

         <div style="text-align: center;">
            <a href="#" class="download-btn" onclick="downloadAPK('carplayer')">
               üì± DOWNLOAD CARPLAYER APK
            </a>
            <a href="https://github.com/bluehawana/carplayer-kotlin-androidauto" target="_blank" class="download-btn">
               üìÇ VIEW SOURCE CODE
            </a>
         </div>

         <div class="features-grid">
            <div class="feature-card">
               <div class="feature-icon">üéØ</div>
               <div class="feature-title">Smart Network Optimization</div>
               <div class="feature-desc">Automatically detects cellular hotspot and optimizes streaming quality</div>
            </div>
            <div class="feature-card">
               <div class="feature-icon">üöó</div>
               <div class="feature-title">Android Auto Native</div>
               <div class="feature-desc">Designed specifically for car infotainment systems with safe controls</div>
            </div>
            <div class="feature-card">
               <div class="feature-icon">üì°</div>
               <div class="feature-title">IPTV & M3U Support</div>
               <div class="feature-desc">Import M3U playlists and manage IPTV subscriptions easily</div>
            </div>
            <div class="feature-card">
               <div class="feature-icon">üîÑ</div>
               <div class="feature-title">Hybrid Media Engine</div>
               <div class="feature-desc">ExoPlayer + VLC fallback with intelligent switching for best compatibility</div>
            </div>
         </div>
      </div>

      <!-- Firebase Testing Gallery Section -->
      <div class="firebase-section" style="margin-top: 20px;">
         <h2 class="firebase-title">üì∏ REAL TESTING ENVIRONMENT - FIREBASE GALLERY</h2>
         
         <div style="text-align: center; margin-bottom: 30px;">
            <p style="color: var(--cyber-text-dim); font-size: 16px; line-height: 1.6;">
               See CarPlayer IPTV in action on real Android Auto systems.<br>
               Screenshots and videos from Firebase App Distribution testing.
            </p>
         </div>

         <!-- Screenshot Gallery Grid -->
         <div class="testing-gallery">
            <div class="gallery-section">
               <h3 style="color: var(--cyber-primary); text-align: center; margin-bottom: 20px;">
                  üì± Android Auto Screenshots
               </h3>
               <div class="screenshot-grid">
                  <div class="screenshot-item" onclick="openScreenshot('carplayer-dashboard')">
                     <div class="screenshot-placeholder">
                        <div class="screenshot-icon">üì∫</div>
                        <div class="screenshot-title">Dashboard View</div>
                        <div class="screenshot-desc">Main interface in car</div>
                     </div>
                  </div>
                  <div class="screenshot-item" onclick="openScreenshot('carplayer-channels')">
                     <div class="screenshot-placeholder">
                        <div class="screenshot-icon">üìã</div>
                        <div class="screenshot-title">Channel List</div>
                        <div class="screenshot-desc">IPTV channel selection</div>
                     </div>
                  </div>
                  <div class="screenshot-item" onclick="openScreenshot('carplayer-streaming')">
                     <div class="screenshot-placeholder">
                        <div class="screenshot-icon">üé¨</div>
                        <div class="screenshot-title">Live Streaming</div>
                        <div class="screenshot-desc">Video playback in car</div>
                     </div>
                  </div>
                  <div class="screenshot-item" onclick="openScreenshot('carplayer-network')">
                     <div class="screenshot-placeholder">
                        <div class="screenshot-icon">üì°</div>
                        <div class="screenshot-title">Network Detection</div>
                        <div class="screenshot-desc">Auto quality adjustment</div>
                     </div>
                  </div>
               </div>
            </div>

            <div class="gallery-section" style="margin-top: 40px;">
               <h3 style="color: var(--cyber-secondary); text-align: center; margin-bottom: 20px;">
                  üé• Testing Videos
               </h3>
               <div class="video-grid">
                  <div class="video-item" onclick="openVideo('carplayer-demo-video')">
                     <div class="video-placeholder">
                        <div class="video-icon">‚ñ∂Ô∏è</div>
                        <div class="video-title">Full Demo Video</div>
                        <div class="video-desc">Complete app walkthrough</div>
                        <div class="video-duration">2:34</div>
                     </div>
                  </div>
                  <div class="video-item" onclick="openVideo('carplayer-android-auto')">
                     <div class="video-placeholder">
                        <div class="video-icon">üöó</div>
                        <div class="video-title">Android Auto Integration</div>
                        <div class="video-desc">Testing in real car environment</div>
                        <div class="video-duration">1:47</div>
                     </div>
                  </div>
                  <div class="video-item" onclick="openVideo('carplayer-network-test')">
                     <div class="video-placeholder">
                        <div class="video-icon">üì±</div>
                        <div class="video-title">Network Optimization</div>
                        <div class="video-desc">Cellular hotspot detection</div>
                        <div class="video-duration">1:12</div>
                     </div>
                  </div>
               </div>
            </div>
         </div>

         <div style="text-align: center; margin-top: 30px;">
            <a href="#" class="download-btn" onclick="viewFirebaseConsole()">
               üî• VIEW FIREBASE CONSOLE
            </a>
            <a href="#" class="download-btn" onclick="viewTestingReports()">
               üìä TESTING REPORTS
            </a>
            <a href="#" class="download-btn" onclick="testVideoDirectly()">
               üé¨ TEST VIDEO DIRECTLY
            </a>
         </div>
      </div>
   </div>

   <script>
      // Live IPTV Channels - Working streams for visitors to preview
      const demoStreams = {
         'demo1': 'http://mwyceyp.mhubery.xyz:80/live/2161039006/6680421603/36480.m3u8', // CNN
         'demo2': 'http://mwyceyp.mhubery.xyz:80/live/2161039006/6680421603/153707.m3u8', // SKY SPORTS NEWS
         'demo3': 'http://mwyceyp.mhubery.xyz:80/live/2161039006/6680421603/6625.m3u8', // USA TODAY
         'demo4': 'http://mwyceyp.mhubery.xyz:80/live/2161039006/6680421603/176619.m3u8', // DW ENGLISH
         'demo5': 'http://mwyceyp.mhubery.xyz:80/live/2161039006/6680421603/400230347.m3u8', // AL JAZEERA
         'demo6': 'http://mwyceyp.mhubery.xyz:80/live/2161039006/6680421603/153691.m3u8', // SKY SPORTS MAIN EVENT
         'demo7': 'http://mwyceyp.mhubery.xyz:80/live/2161039006/6680421603/153693.m3u8', // SKY SPORTS PREMIER LEAGUE
         'demo8': 'http://mwyceyp.mhubery.xyz:80/live/2161039006/6680421603/401172773.m3u8', // SKY SPORTS+
         'demo9': 'http://mwyceyp.mhubery.xyz:80/live/2161039006/6680421603/153695.m3u8', // SKY SPORTS FOOTBALL
         'demo10': 'http://mwyceyp.mhubery.xyz:80/live/2161039006/6680421603/153697.m3u8', // SKY SPORTS CRICKET
         'demo11': 'http://mwyceyp.mhubery.xyz:80/live/2161039006/6680421603/391270.m3u8', // SKY SPORTS TENNIS
         'demo12': 'http://mwyceyp.mhubery.xyz:80/live/2161039006/6680421603/191464.m3u8' // SKY SPORTS F1
      };
      
      // Fallback to public streams if main ones fail
      const fallbackStreams = {
         'demo1': 'https://live-hls-web-aje.getaj.net/AJE/01.m3u8', // Al Jazeera
         'demo2': 'https://dwamdstream102.akamaized.net/hls/live/2015525/dwstream102/index.m3u8', // DW
         'demo3': 'https://static.france24.com/live/F24_EN_LO_HLS/live_web.m3u8', // France 24
         'demo4': 'https://dwamdstream102.akamaized.net/hls/live/2015525/dwstream102/index.m3u8', // DW
         'demo5': 'https://live-hls-web-aje.getaj.net/AJE/01.m3u8', // Al Jazeera
         'demo6': 'https://live-hls-web-aje.getaj.net/AJE/01.m3u8',
         'demo7': 'https://dwamdstream102.akamaized.net/hls/live/2015525/dwstream102/index.m3u8',
         'demo8': 'https://static.france24.com/live/F24_EN_LO_HLS/live_web.m3u8',
         'demo9': 'https://live-hls-web-aje.getaj.net/AJE/01.m3u8',
         'demo10': 'https://dwamdstream102.akamaized.net/hls/live/2015525/dwstream102/index.m3u8',
         'demo11': 'https://static.france24.com/live/F24_EN_LO_HLS/live_web.m3u8',
         'demo12': 'https://live-hls-web-aje.getaj.net/AJE/01.m3u8'
      };

      let currentChannel = 'demo1';
      let isPlaying = false;
      let currentChannelIndex = 0;
      const channels = ['demo1', 'demo2', 'demo3', 'demo4', 'demo5', 'demo6', 'demo7', 'demo8', 'demo9', 'demo10', 'demo11', 'demo12'];
      let videoPlayer = null;

      // Load HLS stream function
      function loadStream(streamUrl, channelName) {
         console.log(`Loading stream: ${streamUrl} for ${channelName}`);
         
         const videoContainer = document.querySelector('.video-container');
         const placeholder = document.getElementById('video-placeholder');
         const player = document.getElementById('video-player');
         
         // Clear any existing HLS instance
         if (window.currentHls) {
            window.currentHls.destroy();
            window.currentHls = null;
         }
         
         // Show loading state
         placeholder.innerHTML = `
            <div>üì° Loading ${channelName}...</div>
            <div style="font-size: 16px; margin-top: 20px; color: var(--cyber-text-dim);">
               Connecting to live stream...
            </div>
         `;
         placeholder.style.display = 'flex';
         player.style.display = 'none';
         
         // Use HLS.js for better compatibility
         if (Hls.isSupported() && streamUrl.includes('.m3u8')) {
            console.log('Using HLS.js for stream playback');
            const hls = new Hls({
               debug: false,
               enableWorker: true,
               lowLatencyMode: true,
               backBufferLength: 90
            });
            
            window.currentHls = hls;
            
            hls.loadSource(streamUrl);
            hls.attachMedia(player);
            
            hls.on(Hls.Events.MANIFEST_PARSED, () => {
               console.log('HLS manifest parsed successfully');
               placeholder.innerHTML = `
                  <div>üîÑ Buffering ${channelName}...</div>
                  <div style="font-size: 14px; margin-top: 10px; color: var(--cyber-text-dim);">
                     Stream ready, starting playback...
                  </div>
               `;
            });
            
            hls.on(Hls.Events.FRAG_LOADED, () => {
               if (player.style.display === 'none') {
                  placeholder.style.display = 'none';
                  player.style.display = 'block';
                  
                  // Auto-play with error handling
                  const playPromise = player.play();
                  if (playPromise !== undefined) {
                     playPromise.then(() => {
                        console.log('HLS stream playing successfully');
                        isPlaying = true;
                        document.getElementById('play-pause-btn').textContent = '‚è∏';
                     }).catch(error => {
                        console.error('HLS autoplay failed:', error);
                        showPlayButton(channelName);
                     });
                  }
               }
            });
            
            hls.on(Hls.Events.ERROR, (event, data) => {
               console.error('HLS error:', data);
               
               // Try fallback stream automatically
               const channelId = getCurrentChannelId();
               const fallbackUrl = fallbackStreams[channelId];
               
               if (fallbackUrl && streamUrl !== fallbackUrl && !window.triedFallback) {
                  console.log('Trying fallback stream:', fallbackUrl);
                  window.triedFallback = true;
                  setTimeout(() => {
                     loadStream(fallbackUrl, channelName + ' (Backup)');
                  }, 1000);
               } else {
                  window.triedFallback = false;
                  handleStreamError(data.details || data.type, streamUrl, channelName);
               }
            });
            
         } else if (player.canPlayType('application/vnd.apple.mpegurl')) {
            console.log('Using native HLS support');
            // Native HLS support (Safari)
            player.src = streamUrl;
            
            // Setup event listeners
            player.onloadstart = () => {
               console.log('Stream loading started');
               placeholder.innerHTML = `
                  <div>üîÑ Buffering ${channelName}...</div>
                  <div style="font-size: 14px; margin-top: 10px; color: var(--cyber-text-dim);">
                     Please wait while we connect to the live stream
                  </div>
               `;
            };
            
            player.oncanplay = () => {
               console.log('Stream ready to play');
               placeholder.style.display = 'none';
               player.style.display = 'block';
               
               // Auto-play with error handling
               const playPromise = player.play();
               if (playPromise !== undefined) {
                  playPromise.then(() => {
                     console.log('Stream playing successfully');
                     isPlaying = true;
                     document.getElementById('play-pause-btn').textContent = '‚è∏';
                  }).catch(error => {
                     console.error('Autoplay failed:', error);
                     placeholder.innerHTML = `
                        <div>‚ñ∂Ô∏è ${channelName} Ready</div>
                        <div style="font-size: 14px; margin-top: 10px; color: var(--cyber-accent);">
                           Click play button to start streaming
                        </div>
                     `;
                     placeholder.style.display = 'flex';
                     player.style.display = 'none';
                  });
               }
            };
            
            player.onerror = (e) => {
               console.error('Stream error:', e);
               let errorMessage = 'Stream temporarily unavailable';
               if (player.error) {
                  switch(player.error.code) {
                     case player.error.MEDIA_ERR_ABORTED:
                        errorMessage = 'Stream aborted by user';
                        break;
                     case player.error.MEDIA_ERR_NETWORK:
                        errorMessage = 'Network error occurred';
                        break;
                     case player.error.MEDIA_ERR_DECODE:
                        errorMessage = 'Stream decode error';
                        break;
                     case player.error.MEDIA_ERR_SRC_NOT_SUPPORTED:
                        errorMessage = 'Stream format not supported';
                        break;
                  }
               }
               
               placeholder.innerHTML = `
                  <div>‚ùå ${channelName}</div>
                  <div style="font-size: 14px; margin-top: 10px; color: var(--cyber-danger);">
                     ${errorMessage}
                  </div>
                  <div style="font-size: 12px; margin-top: 10px; color: var(--cyber-text-dim);">
                     <button onclick="loadStream('${streamUrl}', '${channelName}')" 
                             style="background: var(--cyber-primary); color: black; border: none; padding: 8px 16px; border-radius: 4px; cursor: pointer;">
                        üîÑ Retry
                     </button>
                  </div>
               `;
               placeholder.style.display = 'flex';
               player.style.display = 'none';
            };
            
            player.onloadeddata = () => {
               console.log('Stream data loaded');
            };
            
         } else {
            // Fallback for unsupported streams
            placeholder.innerHTML = `
               <div>‚ö†Ô∏è ${channelName}</div>
               <div style="font-size: 14px; margin-top: 10px; color: var(--cyber-warning);">
                  HLS streaming not supported in this browser
               </div>
               <div style="font-size: 12px; margin-top: 10px; color: var(--cyber-text-dim);">
                  <a href="${streamUrl}" target="_blank" 
                     style="color: var(--cyber-primary); text-decoration: underline;">
                     Open in external player
                  </a>
               </div>
            `;
         }
         
         videoPlayer = player;
      }
      
      // Helper function to show play button when autoplay fails
      function showPlayButton(channelName) {
         const placeholder = document.getElementById('video-placeholder');
         placeholder.innerHTML = `
            <div>‚ñ∂Ô∏è ${channelName} Ready</div>
            <div style="font-size: 14px; margin-top: 10px; color: var(--cyber-accent);">
               Click play button to start streaming
            </div>
         `;
         placeholder.style.display = 'flex';
         document.getElementById('video-player').style.display = 'none';
      }
      
      // Helper function to get current channel ID
      function getCurrentChannelId() {
         const activeChannel = document.querySelector('.channel-item.active');
         return activeChannel ? activeChannel.dataset.channel : 'demo1';
      }
      
      // Helper function to handle stream errors
      function handleStreamError(errorType, streamUrl, channelName) {
         const placeholder = document.getElementById('video-placeholder');
         let errorMessage = 'Stream temporarily unavailable';
         
         if (errorType.includes('NETWORK')) {
            errorMessage = 'Network connection error';
         } else if (errorType.includes('MANIFEST')) {
            errorMessage = 'Stream format error';
         } else if (errorType.includes('MEDIA')) {
            errorMessage = 'Media playback error';
         }
         
         placeholder.innerHTML = `
            <div>‚ùå ${channelName}</div>
            <div style="font-size: 14px; margin-top: 10px; color: var(--cyber-danger);">
               ${errorMessage}
            </div>
            <div style="font-size: 12px; margin-top: 10px; color: var(--cyber-text-dim);">
               <button onclick="loadStream('${streamUrl}', '${channelName}')" 
                       style="background: var(--cyber-primary); color: black; border: none; padding: 8px 16px; border-radius: 4px; cursor: pointer; margin-right: 10px;">
                  üîÑ Retry
               </button>
               <a href="${streamUrl}" target="_blank" 
                  style="color: var(--cyber-primary); text-decoration: underline;">
                  Open Externally
               </a>
            </div>
         `;
         placeholder.style.display = 'flex';
         document.getElementById('video-player').style.display = 'none';
      }

      // Network simulation
      function simulateNetworkDetection() {
         const networks = [
            { status: 'üì∂ WiFi Connected', quality: 'üéØ HD Quality' },
            { status: 'üì± Hotspot Detected', quality: 'üöÄ 5G Optimized' },
            { status: 'üì° Cellular Network', quality: 'üîÑ Adaptive Quality' },
            { status: 'üêå Low Bandwidth', quality: 'üíæ Data Saver Mode' }
         ];
         
         let networkIndex = 0;
         setInterval(() => {
            const network = networks[networkIndex];
            document.getElementById('network-status').textContent = network.status;
            document.getElementById('quality-status').textContent = network.quality;
            networkIndex = (networkIndex + 1) % networks.length;
         }, 5000);
      }

      // Channel selection
      document.querySelectorAll('.channel-item').forEach(item => {
         item.addEventListener('click', function() {
            document.querySelectorAll('.channel-item').forEach(i => i.classList.remove('active'));
            this.classList.add('active');
            
            const channelId = this.dataset.channel;
            currentChannel = channelId;
            currentChannelIndex = channels.indexOf(channelId);
            
            // Load actual video stream
            const channelName = this.querySelector('h4').textContent;
            const streamUrl = demoStreams[channelId];
            
            if (streamUrl) {
               loadStream(streamUrl, channelName);
            } else {
               document.getElementById('video-placeholder').innerHTML = `
                  <div>‚ùå Stream not available</div>
                  <div style="font-size: 16px; margin-top: 20px; color: var(--cyber-text-dim);">
                     ${channelName} ‚Ä¢ Demo Mode
                  </div>
               `;
            }
         });
      });

      // Player controls
      document.getElementById('play-pause-btn').addEventListener('click', function() {
         if (videoPlayer && videoPlayer.src) {
            if (videoPlayer.paused) {
               const playPromise = videoPlayer.play();
               if (playPromise !== undefined) {
                  playPromise.then(() => {
                     isPlaying = true;
                     this.textContent = '‚è∏';
                     console.log('Playback started');
                  }).catch(error => {
                     console.error('Play failed:', error);
                  });
               }
            } else {
               videoPlayer.pause();
               isPlaying = false;
               this.textContent = '‚ñ∂';
               console.log('Playback paused');
            }
         } else {
            // Fallback for when no stream is loaded
            isPlaying = !isPlaying;
            this.textContent = isPlaying ? '‚è∏' : '‚ñ∂';
            
            const placeholder = document.getElementById('video-placeholder');
            if (placeholder.innerHTML.includes('Ready') && isPlaying) {
               // Try to reload current channel
               const activeChannel = document.querySelector('.channel-item.active');
               if (activeChannel) {
                  const channelId = activeChannel.dataset.channel;
                  const channelName = activeChannel.querySelector('h4').textContent;
                  const streamUrl = demoStreams[channelId];
                  if (streamUrl) {
                     loadStream(streamUrl, channelName);
                  }
               }
            }
         }
      });

      document.getElementById('prev-btn').addEventListener('click', function() {
         currentChannelIndex = currentChannelIndex > 0 ? currentChannelIndex - 1 : channels.length - 1;
         document.querySelectorAll('.channel-item')[currentChannelIndex].click();
      });

      document.getElementById('next-btn').addEventListener('click', function() {
         currentChannelIndex = (currentChannelIndex + 1) % channels.length;
         document.querySelectorAll('.channel-item')[currentChannelIndex].click();
      });

      // Volume control
      const volumeSlider = document.getElementById('volume-slider');
      const volumeDisplay = document.getElementById('volume-display');
      
      volumeSlider.addEventListener('input', function() {
         const volume = this.value / 100;
         volumeDisplay.textContent = this.value + '%';
         
         if (videoPlayer) {
            videoPlayer.volume = volume;
            if (volume === 0) {
               videoPlayer.muted = true;
            } else {
               videoPlayer.muted = false;
            }
         }
      });

      // Fullscreen functionality
      document.getElementById('fullscreen-btn').addEventListener('click', function() {
         if (videoPlayer && videoPlayer.src && !videoPlayer.paused) {
            if (videoPlayer.requestFullscreen) {
               videoPlayer.requestFullscreen();
            } else if (videoPlayer.webkitRequestFullscreen) {
               videoPlayer.webkitRequestFullscreen();
            } else if (videoPlayer.mozRequestFullScreen) {
               videoPlayer.mozRequestFullScreen();
            } else if (videoPlayer.msRequestFullscreen) {
               videoPlayer.msRequestFullscreen();
            } else {
               alert('üöó Fullscreen Mode\n\nFullscreen is not supported in this browser.');
            }
         } else {
            alert('üöó Android Auto Fullscreen Mode\n\nStart playing a stream first to enable fullscreen mode.');
         }
      });

      // R2 Storage Base URL
      const R2_BASE_URL = 'https://pub-bdb0b5850f04423d901ad6e7e1195a2a.r2.dev';
      
      // Screenshot mapping
      const screenshots = {
         'carplayer-dashboard': { url: `${R2_BASE_URL}/cartvfirebase/1.png`, title: 'CarPlayer Dashboard' },
         'carplayer-channels': { url: `${R2_BASE_URL}/cartvfirebase/2.png`, title: 'Channel Selection' },
         'carplayer-streaming': { url: `${R2_BASE_URL}/cartvfirebase/3.png`, title: 'Live Streaming' },
         'carplayer-network': { url: `${R2_BASE_URL}/cartvfirebase/4.png`, title: 'Network Detection' }
      };
      
      // Video mapping
      const videos = {
         'carplayer-demo-video': { url: `${R2_BASE_URL}/cartvfirebase/10.mp4`, title: 'Full Demo Video' },
         'carplayer-android-auto': { url: `${R2_BASE_URL}/cartvfirebase/10.mp4`, title: 'Android Auto Integration' },
         'carplayer-network-test': { url: `${R2_BASE_URL}/cartvfirebase/10.mp4`, title: 'Network Optimization Test' }
      };
      
      // Screenshot viewer function
      function openScreenshot(screenshotId) {
         const screenshot = screenshots[screenshotId];
         if (!screenshot) {
            console.error('Screenshot not found:', screenshotId);
            return;
         }
         
         // Create modal overlay
         const modal = document.createElement('div');
         modal.style.cssText = `
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            z-index: 10000;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
         `;
         
         const img = document.createElement('img');
         img.src = screenshot.url;
         img.alt = screenshot.title;
         img.style.cssText = `
            max-width: 90%;
            max-height: 90%;
            border-radius: 10px;
            box-shadow: 0 0 30px rgba(0, 212, 255, 0.5);
         `;
         
         const title = document.createElement('div');
         title.textContent = screenshot.title;
         title.style.cssText = `
            position: absolute;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            color: var(--cyber-primary);
            font-size: 24px;
            font-weight: bold;
            text-shadow: var(--neon-glow);
         `;
         
         modal.appendChild(img);
         modal.appendChild(title);
         document.body.appendChild(modal);
         
         // Close on click
         modal.addEventListener('click', () => {
            document.body.removeChild(modal);
         });
         
         // Close on ESC key
         const escapeHandler = (e) => {
            if (e.key === 'Escape') {
               document.body.removeChild(modal);
               document.removeEventListener('keydown', escapeHandler);
            }
         };
         document.addEventListener('keydown', escapeHandler);
      }
      
      // Video player function
      function openVideo(videoId) {
         const video = videos[videoId];
         if (!video) {
            console.error('Video not found:', videoId);
            return;
         }
         
         console.log('Attempting to play video:', video.url);
         
         // Create modal overlay
         const modal = document.createElement('div');
         modal.style.cssText = `
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            z-index: 10000;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            cursor: pointer;
         `;
         
         const videoElement = document.createElement('video');
         videoElement.src = video.url;
         videoElement.controls = true;
         videoElement.autoplay = true;
         videoElement.muted = true; // Add muted to allow autoplay
         videoElement.playsInline = true; // For mobile compatibility
         videoElement.style.cssText = `
            max-width: 90%;
            max-height: 80%;
            border-radius: 10px;
            box-shadow: 0 0 30px rgba(189, 147, 249, 0.5);
         `;
         
         // Add error handling
         videoElement.addEventListener('error', (e) => {
            console.error('Video error:', e);
            const errorMsg = document.createElement('div');
            errorMsg.textContent = 'Error loading video. Please check console for details.';
            errorMsg.style.cssText = `
               color: var(--cyber-danger);
               font-size: 18px;
               margin-top: 20px;
               text-align: center;
            `;
            modal.appendChild(errorMsg);
            
            // Try alternate approach with direct link
            const altLink = document.createElement('a');
            altLink.href = video.url;
            altLink.target = '_blank';
            altLink.textContent = 'Click here to open video directly';
            altLink.style.cssText = `
               color: var(--cyber-primary);
               font-size: 16px;
               margin-top: 10px;
               text-decoration: underline;
            `;
            modal.appendChild(altLink);
         });
         
         // Add loading state
         videoElement.addEventListener('loadstart', () => {
            console.log('Video loading started');
         });
         
         videoElement.addEventListener('canplay', () => {
            console.log('Video can play');
         });
         
         videoElement.addEventListener('loadedmetadata', () => {
            console.log('Video metadata loaded:', {
               duration: videoElement.duration,
               videoWidth: videoElement.videoWidth,
               videoHeight: videoElement.videoHeight
            });
         });
         
         const title = document.createElement('div');
         title.textContent = video.title;
         title.style.cssText = `
            color: var(--cyber-secondary);
            font-size: 24px;
            font-weight: bold;
            text-shadow: var(--neon-glow);
            margin-bottom: 20px;
         `;
         
         const closeBtn = document.createElement('button');
         closeBtn.textContent = '‚úï Close';
         closeBtn.style.cssText = `
            position: absolute;
            top: 20px;
            right: 20px;
            background: transparent;
            border: 2px solid var(--cyber-danger);
            color: var(--cyber-danger);
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
         `;
         
         modal.appendChild(title);
         modal.appendChild(videoElement);
         modal.appendChild(closeBtn);
         document.body.appendChild(modal);
         
         // Close handlers
         const closeModal = () => {
            videoElement.pause();
            document.body.removeChild(modal);
         };
         
         closeBtn.addEventListener('click', (e) => {
            e.stopPropagation();
            closeModal();
         });
         
         modal.addEventListener('click', (e) => {
            if (e.target === modal) {
               closeModal();
            }
         });
         
         // Close on ESC key
         const escapeHandler = (e) => {
            if (e.key === 'Escape') {
               closeModal();
               document.removeEventListener('keydown', escapeHandler);
            }
         };
         document.addEventListener('keydown', escapeHandler);
         
         // Prevent modal close when clicking video controls
         videoElement.addEventListener('click', (e) => {
            e.stopPropagation();
         });
      }
      
      // Firebase console viewer
      function viewFirebaseConsole() {
         window.open('https://console.firebase.google.com/project/bluehawana-android-auto/overview', '_blank');
      }
      
      // Testing reports viewer
      function viewTestingReports() {
         window.open('https://console.firebase.google.com/project/bluehawana-android-auto/appdistribution/app/android:1:1055425659261:android:5ee98a20ffff8d755c8c14', '_blank');
      }
      
      // Test video directly
      function testVideoDirectly() {
         const testUrl = `${R2_BASE_URL}/cartvfirebase/10.mp4`;
         console.log('Testing video URL:', testUrl);
         
         // Create a simple test modal
         const testModal = document.createElement('div');
         testModal.style.cssText = `
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.95);
            z-index: 10000;
            padding: 20px;
            overflow-y: auto;
         `;
         
         testModal.innerHTML = `
            <div style="max-width: 800px; margin: 0 auto; color: white;">
               <h2 style="color: var(--cyber-primary); margin-bottom: 20px;">Video Test Debug Panel</h2>
               <div style="background: rgba(17, 17, 17, 0.9); padding: 20px; border-radius: 10px; margin-bottom: 20px;">
                  <p><strong>Test URL:</strong> ${testUrl}</p>
                  <p><strong>Status:</strong> <span id="test-status">Initializing...</span></p>
                  <div id="test-results" style="margin-top: 20px;"></div>
               </div>
               
               <div style="margin: 20px 0;">
                  <h3 style="color: var(--cyber-secondary);">Method 1: HTML5 Video Element</h3>
                  <video id="test-video" width="100%" controls style="max-width: 600px; border-radius: 10px;">
                     <source src="${testUrl}" type="video/mp4">
                     Your browser does not support the video tag.
                  </video>
               </div>
               
               <div style="margin: 20px 0;">
                  <h3 style="color: var(--cyber-secondary);">Method 2: Direct Link</h3>
                  <a href="${testUrl}" target="_blank" style="color: var(--cyber-primary); text-decoration: underline;">
                     Open video in new tab
                  </a>
               </div>
               
               <div style="margin: 20px 0;">
                  <h3 style="color: var(--cyber-secondary);">Method 3: Iframe Embed</h3>
                  <iframe src="${testUrl}" width="100%" height="400" style="max-width: 600px; border-radius: 10px; border: 2px solid var(--cyber-border);"></iframe>
               </div>
               
               <button onclick="this.parentElement.parentElement.remove()" style="
                  background: transparent;
                  border: 2px solid var(--cyber-danger);
                  color: var(--cyber-danger);
                  padding: 10px 20px;
                  border-radius: 5px;
                  cursor: pointer;
                  font-size: 16px;
                  margin-top: 20px;
               ">Close Test Panel</button>
            </div>
         `;
         
         document.body.appendChild(testModal);
         
         // Test the video
         const testVideo = document.getElementById('test-video');
         const testStatus = document.getElementById('test-status');
         const testResults = document.getElementById('test-results');
         
         // Check video support
         const videoSupport = testVideo.canPlayType('video/mp4');
         testResults.innerHTML += `<p>Browser MP4 support: ${videoSupport || 'No support'}</p>`;
         
         testVideo.addEventListener('loadstart', () => {
            testStatus.textContent = 'Loading video...';
            testResults.innerHTML += '<p>Event: loadstart</p>';
         });
         
         testVideo.addEventListener('error', (e) => {
            testStatus.textContent = 'Error loading video!';
            testResults.innerHTML += `<p style="color: var(--cyber-danger);">Error: ${e.target.error ? e.target.error.message : 'Unknown error'}</p>`;
            console.error('Video error details:', e);
         });
         
         testVideo.addEventListener('loadeddata', () => {
            testStatus.textContent = 'Video loaded successfully!';
            testResults.innerHTML += '<p style="color: var(--cyber-accent);">Event: loadeddata - Video is ready!</p>';
         });
         
         testVideo.addEventListener('canplay', () => {
            testResults.innerHTML += '<p>Event: canplay</p>';
         });
         
         // Also test with fetch to check CORS
         fetch(testUrl, { method: 'HEAD' })
            .then(response => {
               testResults.innerHTML += `<p>Fetch test: ${response.ok ? 'Success' : 'Failed'} (Status: ${response.status})</p>`;
               testResults.innerHTML += `<p>Content-Type: ${response.headers.get('Content-Type') || 'Not specified'}</p>`;
               testResults.innerHTML += `<p>CORS headers: ${response.headers.get('Access-Control-Allow-Origin') || 'Not present'}</p>`;
            })
            .catch(error => {
               testResults.innerHTML += `<p style="color: var(--cyber-danger);">Fetch error: ${error.message}</p>`;
            });
      }

      // APK download via Firebase App Distribution
      function downloadAPK(appName) {
         if (appName === 'carplayer') {
            window.open('https://appdistribution.firebase.google.com/testerapps/1:1055425659261:android:5ee98a20ffff8d755c8c14/releases/4akk35cdhi1lo', '_blank');
         }
      }

      // Initialize demo
      simulateNetworkDetection();
      
      // Auto-select first channel after a delay
      setTimeout(() => {
         document.querySelector('.channel-item').click();
      }, 1000);
      
      // Set initial volume
      const player = document.getElementById('video-player');
      if (player) {
         player.volume = 0.5; // 50%
         player.muted = false;
      }
   </script>
</body>
</html>